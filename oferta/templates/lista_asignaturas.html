{% extends 'base.html' %}
{% load static %}

{% block content %}
<h1 class="text-3xl font-bold mb-6">
    Oferta académica
    {% if request.GET.sede %}
        <span class="text-2xl font-normal text-gray-400"> - {{ request.GET.sede }}</span>
    {% else %}
        <span class="text-2xl font-normal text-gray-400"> - (Sin sede seleccionada)</span>
    {% endif %}
</h1>

{% include "includes/filtros.html" %}
{% include "includes/tabla_asignaturas.html" %}

<nav class="mt-6 flex flex-wrap justify-center items-center gap-2 text-sm">
    {% if asignaturas.has_previous %}
        <a href="?{% if request.GET %}{{ request.GET.urlencode }}&{% endif %}page={{ asignaturas.previous_page_number }}"
        class="px-3 py-1 bg-gray-700 text-white rounded hover:bg-gray-600">
            &laquo; Anterior
        </a>
    {% else %}
        <span class="px-3 py-1 bg-gray-800 text-gray-500 rounded cursor-not-allowed">
            &laquo; Anterior
        </span>
    {% endif %}

    <span class="px-3 py-1 bg-gray-800 text-gray-300 rounded">
        Página {{ asignaturas.number }} de {{ asignaturas.paginator.num_pages }}
    </span>

    {% if asignaturas.has_next %}
        <a href="?{% if request.GET %}{{ request.GET.urlencode }}&{% endif %}page={{ asignaturas.next_page_number }}"
        class="px-3 py-1 bg-gray-700 text-white rounded hover:bg-gray-600">
            Siguiente &raquo;
        </a>
    {% else %}
        <span class="px-3 py-1 bg-gray-800 text-gray-500 rounded cursor-not-allowed">
            Siguiente &raquo;
        </span>
    {% endif %}
</nav>

<div id="horario" class="mt-4 mb-4"></div>

<div class="mt-4 mb-4 flex flex-col sm:flex-row sm:justify-start gap-3">
    <button onclick="exportarComoICS()" class="w-full sm:w-auto px-4 py-2 bg-green-600 text-white rounded hover:bg-green-500">
    Exportar a Google Calendar (.ics)
    </button>
    <button onclick="exportarComoPDF()" class="w-full sm:w-auto px-4 py-2 bg-blue-600 text-white rounded">
    Exportar como PDF
    </button>
</div>

<script src="{% static 'js/script.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>



<script>
    function resetDependientes(campoCambiado) {
        // 1. Usamos la ID del formulario para evitar errores
        const form = document.getElementById('filtros-form'); 
        
        if (!form) return; // Parar si no se encuentra el formulario

        // 2. Si el usuario cambia la SEDE, reseteamos TODOS los demás filtros
        if (campoCambiado === 'sede') {
            if (form.carrera) form.carrera.value = '';
            if (form.jornada) form.jornada.value = '';
            if (form.nivel) form.nivel.value = '';
            if (form.busqueda) form.busqueda.value = '';
        }
        
        // 3. Si el usuario cambia CARRERA o NIVEL, reseteamos solo el filtro de asignatura
        if (['carrera', 'nivel'].includes(campoCambiado)) {
            if (form.busqueda) form.busqueda.value = '';
        }

        // 4. Enviamos el formulario. Ahora incluirá el valor de "sede"
        // (ya que es un campo más del formulario) junto con el campo cambiado.
        form.submit();
    }
</script>
{% endblock %}